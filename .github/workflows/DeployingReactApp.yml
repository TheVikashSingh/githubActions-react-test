name: Deploying a React Project
on: [push, workflow_dispatch]
jobs:
 testing-the-react-app:
  runs-on: ubuntu-latest
  steps:
   - name: Getting the code
     uses: actions/checkout@v5
   - name: Installing NodeJS
     uses: actions/setup-node@v3
     with:
      node-version: 20
   - name: Caching npm dependencies
     uses: actions/cache@v4
     with:
      path: ~/.npm
      key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}   
      restore-keys: |
       ${{ runner.os }}-npm-
   - name: Installing dependencies
     run: npm ci
   - name: Running the Test
     run: npm run test    
 building-the-react-app:
  needs: testing-the-react-app
  runs-on: ubuntu-latest
  outputs:
   version: ${{ steps.my_run_version_id.outputs.version }} 
  steps:
    - name: Getting the version
      id: my_run_version_id
      run: echo "version=1.2.${{ github.run_number }}" >> $GITHUB_OUTPUT
    - name: Getting the code
      uses: actions/checkout@v5
    - name: Installing NodeJS
      uses: actions/setup-node@v3
      with:
       node-version: 20
    - name: Restoring npm cache
      uses: actions/cache@v4
      with:
       path: ~/.npm
       key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
       restore-keys: |
        ${{ runner.os }}-npm-   
    - name: Installing dependencies
      run: npm ci
    - name: Building the app
      run: npm run build
    - name: Uploading the artifacts
      uses: actions/upload-artifact@v4
      with:
       name: dist-build
       path: |  #uploading package.json just to learn use of the pipe operator
        dist/   
        package.json
 deploying:
  needs: building-the-react-app 
  runs-on: ubuntu-latest
  steps:
   - name: show items available
     run: ls      
   - name: Downloading the artifacts into this machine
     uses: actions/download-artifact@v5
     with:
      name: dist-build
   - name: checking items available again
     run: ls   
   - name: Showing the version from  building-the-react-app job  
     run: echo "Deploying version ${{ needs.building-the-react-app.outputs.version }}"
   - name: Deploying this app
     run: echo "Deploying this react app..."
            






